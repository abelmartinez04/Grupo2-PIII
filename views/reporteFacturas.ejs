<%- include("partials/header") %>

<main class="flex-grow-1 d-flex align-items-center bg-light">
  <div class="container py-4">
    <h1 class="fw-bold text-success mb-4">Reporte de Facturas</h1>

    <section class="card mb-4">
      <div class="card-body">
        <form method="GET" action="/reporte-facturas" class="row g-3 align-items-center">
          <div class="col-md-4">
            <label for="fecha_desde" class="form-label">Desde:</label>
            <input type="date" name="fecha_desde" id="fecha_desde" class="form-control" value="<%= filtros.fecha_desde %>">
          </div>
          <div class="col-md-4">
            <label for="fecha_hasta" class="form-label">Hasta:</label>
            <input type="date" name="fecha_hasta" id="fecha_hasta" class="form-control" value="<%= filtros.fecha_hasta %>">
          </div>
          <div class="col-md-2 align-self-end">
            <button type="submit" class="btn btn-primary w-100">Consultar</button>
          </div>
        </form>
      </div>
    </section>

    <section class="card mb-4">
        <div class="card-body">
            <p class="mb-1"><strong>Mostrando resultados para:</strong> <%= filtros.fecha_desde_amigable %> hasta <%= filtros.fecha_hasta_amigable %></p>
            <p class="mb-1"><strong>Total de facturas:</strong> <%= resumen.total_facturas %></p>
            <p class="mb-0 fw-bold"><strong>Total cobrado:</strong> <span class="text-success">RD$ <%= parseFloat(resumen.total_cobrado).toFixed(2) %></span></p>
        </div>
    </section>

    <section class="card">
      <div class="card-header">
        Facturas
      </div>
      <div class="card-body">
        <div class="table-responsive">
          <table class="table table-striped table-hover">
            <thead>
              <tr>
                <th>#ID</th>
                <th>Fecha</th>
                <th>Nº Factura</th>
                <th>Cliente</th>
                <th class="text-end">Total</th>
                <th class="text-center">Acciones</th>
              </tr>
            </thead>
            <tbody>
              <% if (ventas.length === 0) { %>
                <tr>
                  <td colspan="6" class="text-center">No se encontraron facturas para este rango de fechas.</td>
                </tr>
              <% } %>
              
              <% ventas.forEach(venta => { %>
                <tr>
                  <td><%= venta.id %></td>
                  <td><%= new Date(venta.fecha_venta).toLocaleDateString('es-DO') %></td>
                  <td><%= venta.numero_factura %></td>
                  <td><%= venta.cliente_nombre %></td>
                  <td class="text-end">RD$ <%= parseFloat(venta.total).toFixed(2) %></td>
                  <td class="text-center">
                    <a href="/ventas/imprimir/<%= venta.id %>" class="btn btn-info btn-sm" target="_blank">Imprimir</a>
                    
                    <form action="/reporte-facturas/eliminar/<%= venta.id %>" method="POST" style="display: inline;" onsubmit="return confirm('¿Estás seguro de que quieres eliminar esta factura? Esta acción no se puede deshacer.');">
                      <button type="submit" class="btn btn-danger btn-sm">Eliminar</button>
                    </form>
                  </td>
                </tr>
              <% }) %>
            </tbody>
          </table>
        </div>
      </div>
    </section>

  </div>
</main>

<%- include("partials/footer") %>